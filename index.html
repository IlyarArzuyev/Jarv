<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>JARVIS + Claude</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      user-select: none;
    }
    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }
    #status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ffff;
      background: rgba(0, 255, 255, 0.1);
      padding: 10px 20px;
      border: 1px solid #00ffff55;
      border-radius: 10px;
      backdrop-filter: blur(6px);
      text-shadow: 0 0 5px #00ffff;
    }
    #voiceBtn {
      width: 140px;
      height: 140px;
      background: url('IMG_9435.jpeg') no-repeat center;
      background-size: cover;
      border: 4px solid #00ffff;
      border-radius: 50%;
      box-shadow: 0 0 20px #00ffff, inset 0 0 30px #00ffff;
      cursor: pointer;
      transition: 0.3s;
    }
    #voiceBtn.active {
      box-shadow: 0 0 50px #00ffff, 0 0 100px #00ffff, inset 0 0 60px #00ffff;
      transform: scale(1.05);
    }
  </style>
</head>
<body>

<div class="center">
  <button id="voiceBtn" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞"></button>
</div>
<div id="status">üé§ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>

<script>
  const voiceBtn = document.getElementById("voiceBtn");
  const statusDiv = document.getElementById("status");

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "ru-RU";
  recognition.continuous = false;
  recognition.interimResults = false;

  let isListening = false;
  let lastTranscript = "";
  let silenceTimeout = null;

  const part1 = "sk-ant-";
  const part2 = "api03-1uqemFV5tdYVeN53GAMnJzutPCblJ73wTR0-16Y_2wQKOP4gBKT16tYhoRcMfuZEbjwhe0k6SfDaruxaogc1Dg-LB31uQAA";
  const apiKey = part1 + part2;

  function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ru-RU";
    utter.pitch = 0.8;
    utter.rate = 1.05;
    utter.volume = 1;
    speechSynthesis.speak(utter);
  }

  async function askClaude(prompt) {
    statusDiv.textContent = "ü§ñ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Claude...";
    try {
      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "x-api-key": apiKey,
          "anthropic-version": "2023-06-01",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "claude-3-haiku-20240307",
          max_tokens: 100,
          messages: [{ role: "user", content: prompt }]
        })
      });

      const data = await response.json();
      const reply = data?.content?.[0]?.text || "–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª.";
      statusDiv.textContent = "‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω";
      speak(reply);
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ Claude:", e);
      statusDiv.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ Claude";
      speak("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –ò–ò");
    }
  }

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript.trim();
    lastTranscript = transcript;
    statusDiv.textContent = `üéôÔ∏è –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "${transcript}"`;

    if (silenceTimeout) clearTimeout(silenceTimeout);
    silenceTimeout = setTimeout(() => {
      askClaude(lastTranscript);
      lastTranscript = "";
      if (isListening) recognition.start();
    }, 2000);
  };

  recognition.onend = () => {
    if (isListening && !lastTranscript) recognition.start();
  };

  recognition.onerror = (e) => {
    statusDiv.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: " + e.error;
  };

  function startListening() {
    isListening = true;
    recognition.start();
    voiceBtn.classList.add("active");
    statusDiv.textContent = "üé§ –°–ª—É—à–∞—é...";
  }

  function stopListening() {
    isListening = false;
    recognition.stop();
    voiceBtn.classList.remove("active");
    statusDiv.textContent = "üîá –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
  }

  voiceBtn.addEventListener("click", () => {
    if (!isListening) {
      speak("–í–∫–ª—é—á–∞—é –≥–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º", startListening);
    } else {
      stopListening();
      speak("–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º –æ—Ç–∫–ª—é—á—ë–Ω");
    }
  });
</script>

</body>
</html>