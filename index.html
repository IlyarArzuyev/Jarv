<!DOCTYPE html>
<html lang="ru">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>JARVIS Debug</title><style>
html,body{margin:0;padding:0;height:100%;background:black;color:#0ff;font-family:sans-serif;user-select:none;overflow:hidden}
.center{display:flex;justify-content:center;align-items:center;height:100%}
#voiceBtn{width:140px;height:140px;background:#00ffff;border-radius:50%;border:none;cursor:pointer;opacity:0.8}
#voiceBtn.active{box-shadow:0 0 50px #00ffff}
#status{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(0,255,255,0.1);padding:8px 16px;border-radius:8px;text-align:center}
</style></head>
<body>

<div class="center">
  <button id="voiceBtn">üéô JARVIS</button>
</div>
<div id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

<script>
const voiceBtn = document.getElementById("voiceBtn");
const status = document.getElementById("status");

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
if(!SR){ status.textContent = "‚ùå SpeechRecognition –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"; throw new Error("No SR"); }

const rec = new SR();
rec.lang = 'ru-RU'; rec.continuous = false; rec.interimResults = false;

let listening = false, lastText = "", tID = null;
const part1 = "sk-ant-";
const part2 = "api03-1uqemFV5tdYVeN53GAMnJzutPCblJ73wTR0-16Y_2wQKOP4gBKT16tYhoRcMfuZEbjwhe0k6SfDaruxaogc1Dg-LB31uQAA";
const apiKey = part1 + part2;

function logErr(msg, e){
  console.error(msg, e);
  status.textContent = `‚ùó ${msg}: ${e.message||e}`;
}

function speak(text, cb){
  status.textContent = `üó£ ${text}`;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "ru-RU"; u.pitch = 0.8; u.rate = 1.05;
  u.onend = ()=>cb?.();
  speechSynthesis.speak(u);
}

async function askClaude(prompt){
  try {
    status.textContent = "ü§ñ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å –∫ Claude...";
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "x-api-key": apiKey,
        "anthropic-version": "2023-06-01",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "claude-3-haiku-20240307",
        max_tokens: 100,
        messages: [{ role: "user", content: prompt }]
      })
    });
    if(!res.ok){
      const text = await res.text();
      throw new Error(`HTTP ${res.status}: ${text}`);
    }
    const data = await res.json();
    const reply = data.content?.[0]?.text || "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞";
    speak(reply);
  } catch(e) {
    logErr("–û—à–∏–±–∫–∞ Claude", e);
  }
}

rec.onresult = e => {
  lastText = e.results[0][0].transcript.trim().toLowerCase();
  status.textContent = `üéô –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "${lastText}"`;
  if(tID) clearTimeout(tID);
  tID = setTimeout(()=>{
    if(!checkApps(lastText)) askClaude(lastText);
    lastText = "";
    if(listening) rec.start();
  },2000);
};
rec.onend = ()=>{ if(listening && !lastText){ rec.start(); status.textContent="üåÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É—à–∞–Ω–∏—è"; } };
rec.onerror = e=>logErr("–û—à–∏–±–∫–∞ SR", e);

function checkApps(t){
  const map = {
    '—Ç–µ–ª–µ–≥—Ä–∞–º': 'tg://',
    '–≤–∞—Ç—Å–∞–ø': 'whatsapp://',
    '—é—Ç—É–±': 'youtube://',
    '–∏–Ω—Å—Ç–∞–≥—Ä–∞–º': 'instagram://',
    '—Ç–∏–∫ —Ç–æ–∫': 'snssdk1128://',
    '–∫–∞—Å–ø–∏': 'kaspi://'
  };
  for(let k in map){
    if(t.includes(k)){
      status.textContent = `üîó –û—Ç–∫—Ä—ã–≤–∞—é ${k}`;
      speak(`–û—Ç–∫—Ä—ã–≤–∞—é ${k}`);
      window.location.href = map[k];
      return true;
    }
  }
  return false;
}

function start(){
  listening = true;
  rec.start();
  voiceBtn.classList.add("active");
  status.textContent = "üé§ –°–ª—É—à–∞—é...";
}
function stop(){
  listening = false;
  rec.stop();
  voiceBtn.classList.remove("active");
  status.textContent = "üõë –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
}

voiceBtn.onclick = ()=>{
  if(!listening){
    speak("–ê–∫—Ç–∏–≤–∏—Ä—É—é —Ä–µ–∂–∏–º", start);
  } else {
    stop();
  }
};

// –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
status.textContent = "–ì–æ—Ç–æ–≤–æ.";
</script>

</body>
</html>