<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>JARVIS Assistant</title>
  <style>
    html, body {
      margin: 0; padding: 0; background: black; color: #00ffff;
      height: 100%; display: flex; justify-content: center; align-items: center;
      font-family: 'Segoe UI', sans-serif; user-select: none; overflow: hidden;
    }
    #voiceBtn {
      width: 160px; height: 160px; border-radius: 50%;
      background: radial-gradient(circle, #00ffff33, #001f1f);
      border: 2px solid #00ffffaa;
      box-shadow: 0 0 25px #00ffff;
      transition: 0.3s;
    }
    #voiceBtn.active {
      box-shadow: 0 0 40px #00ffff, inset 0 0 30px #00ffff;
      transform: scale(1.05);
    }
    #status {
      position: absolute; bottom: 20px; text-align: center; font-size: 16px;
      background: rgba(0,255,255,0.1); border: 1px solid #00ffff44;
      border-radius: 8px; padding: 8px 16px; backdrop-filter: blur(5px);
      text-shadow: 0 0 5px #00ffff;
    }
  </style>
</head>
<body>
  <button id="voiceBtn"></button>
  <div id="status">üåÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JARVIS...</div>

  <script>
    const voiceBtn = document.getElementById('voiceBtn');
    const status = document.getElementById('status');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new SpeechRecognition();
    rec.lang = 'ru-RU'; rec.continuous = false; rec.interimResults = false;

    const part1 = "sk-ant-api03-1uqemFV5tdYVeN53GAMnJzutPCblJ73wTR0-";
    const part2 = "16Y_2wQKOP4gBKT16tYhoRcMfuZEbjwhe0k6SfDaruxaogc1Dg-LB31uQAA";
    const apiKey = part1 + part2;

    let isListening = false;
    let lastTranscript = "";
    let silenceTimeout = null;

    function speak(text, callback) {
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ru-RU";
      u.pitch = 0.8;
      u.rate = 1.05;
      u.volume = 1;
      if (callback) u.onend = callback;
      speechSynthesis.speak(u);
    }

    async function askClaude(prompt) {
      try {
        status.textContent = "ü§ñ –ó–∞–ø—Ä–æ—Å –∫ Claude...";
        const res = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "x-api-key": apiKey,
            "anthropic-version": "2023-06-01",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "claude-3-haiku-20240307",
            max_tokens: 100,
            messages: [{ role: "user", content: prompt }]
          })
        });
        const data = await res.json();
        const reply = data?.content?.[0]?.text || "–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω.";
        status.textContent = "‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω";
        speak(reply);
      } catch (e) {
        status.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: " + e.message;
        console.error("Claude error:", e);
        speak("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –ò–ò");
      }
    }

    const appURIs = {
      '—Ç–µ–ª–µ–≥—Ä–∞–º': 'tg://',
      '–≤–∞—Ç—Å–∞–ø': 'whatsapp://',
      '—é—Ç—É–±': 'youtube://',
      '–∏–Ω—Å—Ç–∞–≥—Ä–∞–º': 'instagram://',
      '—Ç–∏–∫ —Ç–æ–∫': 'snssdk1128://',
      '–∫–∞—Å–ø–∏': 'kaspi://'
    };

    function checkApps(text) {
      for (let key in appURIs) {
        if (text.includes(key)) {
          window.location.href = appURIs[key];
          speak(`–û—Ç–∫—Ä—ã–≤–∞—é ${key}`);
          return true;
        }
      }
      return false;
    }

    rec.onresult = e => {
      lastTranscript = e.results[0][0].transcript.trim().toLowerCase();
      status.textContent = `üéß –í—ã —Å–∫–∞–∑–∞–ª–∏: "${lastTranscript}"`;

      if (silenceTimeout) clearTimeout(silenceTimeout);
      silenceTimeout = setTimeout(() => {
        if (!checkApps(lastTranscript)) askClaude(lastTranscript);
        lastTranscript = "";
        if (isListening) rec.start();
      }, 2000);
    };

    rec.onend = () => {
      if (isListening && !lastTranscript) rec.start();
    };

    rec.onerror = e => {
      status.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: " + e.error;
    };

    function startListening() {
      isListening = true;
      rec.start();
      voiceBtn.classList.add("active");
      status.textContent = "üéôÔ∏è –°–ª—É—à–∞—é...";
    }

    function stopListening() {
      isListening = false;
      rec.stop();
      voiceBtn.classList.remove("active");
      status.textContent = "üîá –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
    }

    voiceBtn.onclick = () => {
      if (!isListening) {
        speak("–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞", startListening);
      } else {
        stopListening();
        speak("–í—ã–∫–ª—é—á–∞—é —Å–ª—É—à–∞–Ω–∏–µ");
      }
    };

    // ‚è± –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      speak("–ö –≤–∞—à–∏–º —É—Å–ª—É–≥–∞–º, —Å—ç—Ä", startListening);
    }, 3000);
  </script>
</body>
</html>